#!/bin/bash

set -euo pipefail
IFS=$'\n\t'

cd $OUTPUT_FOLDER
echo $CODE >code.py

echo "Generating requirements.txt ...">$LOG_FILE
pipreqs --savepath=requirements.txt --force code.py

echo "Creating environment ...">$LOG_FILE
python3 -m venv .venv
.venv/bin/pip install -U pip wheel
.venv/vin/pip install -r requirements.txt

echo "Executing code ....">$LOG_FILE
.venv/bin/python3 code.py \
    >>$LOG_FILE 2>&1

echo "DONE">$LOG_FILE



# then retrieve the output and move it to the $OUTPUT_FOLDER
# as defined in the output labels


# For example: cp output.csv $OUTPUT_FOLDER or to $OUTPUT_FOLDER/output.json using jq
# cat > $OUTPUT_FOLDER/output.json << EOF
# {

#     "output_1":"some_stuff"

# }
# EOF

